headers = pthread.h
---

pthread_mutex_t mutex;

typedef struct {
    char **array;
    size_t used;
    size_t size;
} MessageQueue;

MessageQueue *messageQu;


void createQueue() {
    pthread_mutex_init(&mutex, NULL);
    static MessageQueue data;
    (void) memset((void *) &data, 0, sizeof(data));
    messageQu = &data;
    messageQu->array = (char **) malloc(1 * sizeof(char *));
    messageQu->used = 0;
    messageQu->size = 1;
    messageQu->array[0] = NULL;
}

MessageQueue *get() {
    return messageQu;
}

void addMessage(char *element) {

    //pthread_mutex_lock(&mutex);
    if (messageQu->used == messageQu->size) {
        messageQu->size *= 2;
        messageQu->array = (char **) realloc(messageQu->array, messageQu->size * sizeof(char *));
    }
    size_t i = messageQu->used++;
    messageQu->array[i] = element;
    //pthread_mutex_unlock(&mutex);

}


void wsLock(){
  pthread_mutex_lock(&mutex);
}
void wsUnlock(){
  pthread_mutex_unlock(&mutex);
}

int size(){
    pthread_mutex_lock(&mutex);
    int s = messageQu->used;
    pthread_mutex_unlock(&mutex);
    return s;
}


char *first() {
    if (messageQu->used == 0) {
        return NULL;
    }
   return messageQu->array[0];
}

char *getMessage() {
    if (messageQu->used == 0) {
        pthread_mutex_unlock(&mutex);
        return NULL;
    }
    pthread_mutex_lock(&mutex);
    char *string = messageQu->array[0];
    messageQu->used = messageQu->used - 1;

    for (int i = 0; i < messageQu->size; i++) {
        messageQu->array[i] = messageQu->array[i + 1];
    }
    messageQu->array = (char **) realloc(messageQu->array, messageQu->size * sizeof(char *));
    pthread_mutex_unlock(&mutex);
    return string;
}